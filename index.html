
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Yes to Nails - Service Calculator</title>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<style>
    :root {
      --pink: #ffcce0;
      --baby-pink: #ffe6f0;
      --white: #ffffff;
      --dark-pink: #d63384;
      --button-pink: #ff99cc;
    }
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      background-color: var(--baby-pink);
      color: #333;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }
    header, footer {
      background-color: var(--pink);
      text-align: center;
      padding: 1.5em;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    header img {
      max-height: 80px;
      margin-bottom: 0.5em;
    }
    header h1 {
      margin: 0;
      color: var(--dark-pink);
      font-size: 1.8rem;
    }
    nav {
      text-align: center;
      padding: 0.8em;
      background-color: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    nav a {
      text-decoration: none;
      color: var(--dark-pink);
      font-weight: bold;
      cursor: pointer;
      padding: 0.5em 1em;
      border-radius: 4px;
      transition: background-color 0.3s;
    }
    nav a:hover {
      background-color: var(--pink);
    }
    main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      padding: 2em;
      gap: 1.5em;
      max-width: 1200px;
      margin: 0 auto;
    }
    section {
      background: var(--white);
      padding: 1.5em;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.08);
    }
    h2 {
      color: var(--dark-pink);
      margin-top: 0;
      border-bottom: 2px solid var(--pink);
      padding-bottom: 0.5em;
    }
    .service {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8em 0;
      border-bottom: 1px solid #eee;
    }
    .service:hover {
      background-color: #f9f9f9;
    }
    .service-info {
      flex-grow: 1;
    }
    .service-name {
      font-weight: bold;
    }
    .service-details {
      font-size: 0.9em;
      color: #666;
    }
    .service-price {
      font-weight: bold;
      margin: 0 1em;
    }
    .service-duration {
      color: #666;
      font-size: 0.9em;
      margin-right: 1em;
    }
    .add-btn {
      background-color: var(--button-pink);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0.4em 0.8em;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .add-btn:hover {
      background-color: var(--dark-pink);
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8em 0;
      border-bottom: 1px solid #eee;
    }
    .remove-btn {
      background-color: #ff6b6b;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0.3em 0.6em;
      cursor: pointer;
      font-size: 0.8em;
    }
    .cart-empty {
      text-align: center;
      color: #999;
      padding: 2em 0;
    }
    .total-section {
      margin-top: 1em;
      padding-top: 1em;
      border-top: 2px dashed var(--pink);
    }
    .total-row {
      display: flex;
      justify-content: space-between;
      font-weight: bold;
    }
    form input, form select, form textarea {
      width: 100%;
      padding: 0.8em;
      margin: 0.5em 0 1em;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      font-family: inherit;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1em;
    }
    .btn {
      background-color: var(--button-pink);
      color: white;
      padding: 0.8em;
      border: none;
      width: 100%;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1em;
      transition: background-color 0.3s;
    }
    .btn:hover {
      background-color: var(--dark-pink);
    }
    #adminPanelpper {
      display: none;
      max-width: 800px;
      margin: 2em auto;
      padding: 2em;
      background: var(--white);
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .hidden {
      display: none !important;
    }
    .logout-link {
      text-align: right;
      margin: 0.5em;
      font-size: 0.9em;
      cursor: pointer;
      color: var(--dark-pink);
    }
    .logout-link:hover {
      text-decoration: underline;
    }
    .confirmation-box {
      background-color: #d4edda;
      color: #155724;
      padding: 1em;
      border-radius: 4px;
      margin: 1em 0;
      text-align: center;
    }
    .error-box {
      background-color: #f8d7da;
      color: #721c24;
      padding: 1em;
      border-radius: 4px;
      margin: 1em 0;
      text-align: center;
    }
    .admin-actions {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1em;
      margin: 1em 0;
    }
    .admin-card {
      background-color: #f8f9fa;
      padding: 1em;
      border-radius: 8px;
      text-align: center;
    }
    .admin-card h3 {
      margin-top: 0;
      color: var(--dark-pink);
    }
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1em 0;
    }
    .admin-table th, .admin-table td {
      padding: 0.8em;
      border: 1px solid #ddd;
      text-align: left;
    }
    .admin-table th {
      background-color: var(--pink);
    }
    .admin-form {
      margin: 1em 0;
    }
    .back-btn {
      background-color: #6c757d;
      color: white;
      padding: 0.5em 1em;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 1em;
    }
    .category-badge {
      display: inline-block;
      background-color: var(--pink);
      color: var(--dark-pink);
      padding: 0.2em 0.6em;
      border-radius: 12px;
      font-size: 0.8em;
      margin-right: 0.5em;
    }
    .time-slot {
      display: inline-block;
      padding: 0.5em 1em;
      margin: 0.3em;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      background-color: #f8f9fa;
    }
    .time-slot.selected {
      background-color: var(--pink);
      color: var(--dark-pink);
      font-weight: bold;
    }
    .time-slot.booked {
      background-color: #e9ecef;
      color: #adb5bd;
      cursor: not-allowed;
      text-decoration: line-through;
    }
    .time-slots-container {
      margin: 1em 0;
    }
    .business-hours-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1em 0;
    }
    .business-hours-table th, .business-hours-table td {
      padding: 0.5em;
      border: 1px solid #ddd;
    }
    .business-hours-table th {
      background-color: var(--pink);
      text-align: left;
    }
    .business-hours-table input[type="time"] {
      width: 100%;
      padding: 0.5em;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .business-hours-table input[type="checkbox"] {
      width: auto;
      margin: 0;
    }
    .logo-preview {
      max-width: 200px;
      max-height: 100px;
      margin: 1em 0;
      border: 1px dashed #ddd;
      padding: 0.5em;
    }
    .logo-upload-container {
      margin: 1em 0;
    }
    .logo-upload-container input[type="file"] {
      margin-bottom: 1em;
    }
    .tab-container {
      margin: 1em 0;
    }
    .tab-buttons {
      display: flex;
      border-bottom: 1px solid #ddd;
    }
    .tab-button {
      padding: 0.8em 1.5em;
      background-color: #f8f9fa;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    .tab-button.active {
      background-color: var(--pink);
      color: var(--dark-pink);
      border-bottom: 2px solid var(--dark-pink);
    }
    .tab-content {
      padding: 1em 0;
    }
    .tab-panel {
      display: none;
    }
    .tab-panel.active {
      display: block;
    }
    .success-message {
      background-color: #d4edda;
      color: #155724;
      padding: 0.5em;
      border-radius: 4px;
      margin: 0.5em 0;
      text-align: center;
    }
    .email-settings {
      margin: 1em 0;
      padding: 1em;
      background-color: #f8f9fa;
      border-radius: 8px;
    }
    .email-settings h4 {
      margin-top: 0;
      color: var(--dark-pink);
    }
    .email-toggle {
      display: flex;
      align-items: center;
      margin: 1em 0;
    }
    .email-toggle label {
      margin-left: 0.5em;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: var(--button-pink);
    }
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    footer {
      padding: 2em;
      text-align: center;
      color: var(--dark-pink);
      font-size: 0.9em;
    }
    @media (max-width: 768px) {
      main {
        grid-template-columns: 1fr;
        padding: 1em;
      }
      .form-row {
        grid-template-columns: 1fr;
      }
      header h1 {
        font-size: 1.5rem;
      }
      .admin-actions {
        grid-template-columns: 1fr;
      }
    }
    
    #cartSection {
      grid-column: span 2;
    }
/* Logo SVG */
    .logo-svg {
      width: 80px;
      height: 80px;
    }
    .env-warning {
      background-color: #fff3cd;
      color: #856404;
      padding: 1em;
      border-radius: 4px;
      margin: 1em 0;
      text-align: center;
      display: none;
    }
    #editServiceForm {
      background-color: #f8f9fa;
      padding: 1.5em;
      border-radius: 8px;
      margin: 1em 0;
      border: 2px solid var(--pink);
      display: none;
    }
    #editServiceForm h4 {
      margin-top: 0;
      color: var(--dark-pink);
      border-bottom: 2px solid var(--pink);
      padding-bottom: 0.5em;
    }
.shimmer-text {
  font-weight: bold;
  font-size: 2rem;
  background: linear-gradient(
    to right,
    red,
    orange,
    yellow,
    green,
    blue,
    indigo,
    violet
  );
  background-size: 300% auto;
  color: transparent;
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: shimmerTextRainbow 10s ease-in-out infinite;
}

@keyframes shimmerTextRainbow {
  0% {
    background-position: -200% center;
  }
  100% {
    background-position: 200% center;
  }
}
   .service-meta {
  flex: 1;
  min-width: 100px;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  justify-content: center;
  text-align: right;
  gap: 0.5em;
}
.service-list-card {
  background-color: #fff;
  border-radius: 12px;
  padding: 1.5em;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  margin: 1.5em 0;           /* vertical margin only */
  width: 100%;
  box-sizing: border-box;
}
.service-item {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 1em 0;
  border-bottom: 1px solid #eee;
}
.service-info {
  flex-grow: 1;
}
.service-title {
  font-weight: bold;
  margin: 0;
}
.service-category {
  font-size: 0.8em;
  color: #d63384;
  background-color: #ffe6f0;
  padding: 0.2em 0.6em;
  border-radius: 12px;
  display: inline-block;
  margin-top: 0.3em;
}
.service-description {
  font-size: 0.9em;
  margin: 0.5em 0;
  color: #555;
}
.service-meta {
  text-align: right;
  min-width: 120px;
}
.service-meta p {
  margin: 0.2em 0;
}
.add-btn {
  background-color: #ff99cc;
  color: white;
  border: none;
  border-radius: 4px;
  padding: 0.4em 0.8em;
  cursor: pointer;
}
.add-btn:hover {
  background-color: #d63384;
}
    .admin-section {
  background-color: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
  padding: 2em;
  margin: 2em auto;
  max-width: 960px;
  width: 100%;
  box-sizing: border-box;
}
    .admin-actions {
  display: flex;
  gap: 1.5em;
  justify-content: space-between;
  flex-wrap: wrap;
  margin-bottom: 2em;
}

.admin-card {
  flex: 1 1 30%;
  background-color: #fff;
  padding: 1.5em;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
}
    .admin-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1em;
  font-size: 0.95rem;
}

.admin-table th,
.admin-table td {
  padding: 0.75em 1em;
  text-align: left;
  border-bottom: 1px solid #eee;
}

.admin-table th {
  background-color: #ffcce5;
  color: #333;
  font-weight: 600;
}

.admin-table td input {
  width: 100%;
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-sizing: border-box;
}

.admin-table button {
  background-color: #ff4d6d;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 6px 12px;
  cursor: pointer;
  font-weight: bold;
}

.admin-table button:hover {
  background-color: #e43d5e;
}


  </style>
</head>
<body>
<header>
<div id="logoContainer">
<!-- Logo will be inserted here -->
</div>
<h1 class="shimmer-text">Yes to Nails ®</h1>
</header>
<nav>
<a onclick="showUserPanel()">Services</a> | 
    <a onclick="showAdminLogin()">Admin</a>
</nav>
<main id="userPanel">
<section id="services">
  <div class="service-list-card">
    <h2>Browse Services</h2>
    <select id="categoryFilter" onchange="filterServices()">
      <option value="all">All Categories</option>
    </select>
    <div id="serviceList"></div>
  </div>
</section>
<section id="cartSection" class="service-list-card">
<div class="service-list-card">
<h2>Your Selection</h2>
<div id="cart"></div>
<div class="total-section">
<div class="total-row">
<span>Total Duration:</span>
<span id="totalDuration">0 mins</span>
</div>
<div class="total-row">
<span>Total Price:</span>
<span>AED <span id="totalPrice">0.00</span></span>
</div>
</div>
</section>
<section class="embossed-box" style="grid-column: span 2;">
<div class="service-list-card">
<h2>Book Your Appointment</h2>
<div class="env-warning" id="envWarning">
<strong>Note:</strong> Email functionality requires server-side configuration. In this GitHub Pages deployment, emails will be simulated but not actually sent.
      </div>
<form id="bookingForm" onsubmit="submitBooking(event)">
<div class="form-row">
<div>
<label for="name">Full Name</label>
<input id="name" placeholder="Your Name" required="" type="text"/>
</div>
<div>
<label for="email">Email</label>
<input id="email" placeholder="Your Email" required="" type="email"/>
</div>
</div>
<div class="form-row">
<div>
<label for="phone">Phone Number</label>
<input id="phone" placeholder="Your Phone Number" required="" type="tel"/>
</div>
<div>
<label for="bookingDate">Preferred Date</label>
<input id="bookingDate" onchange="window.showTimeSlots()" required type="date" />
</div>
</div>
<div>
<label>Select Time Slot</label>
<div class="time-slots-container" id="timeSlots">
<p>Please select a date first</p>
</div>
<input id="selectedTime" type="hidden"/>
</div>
<label for="notes">Special Requests</label>
<textarea id="notes" placeholder="Any special requests or notes" rows="3"></textarea>
<button class="btn" id="bookingSubmitBtn" type="submit">Confirm Booking</button>
 </form>
<div id="confirmation"></div>
</section>
</main> <!-- 🔽 START: Admin Panel Wrapper -->
<div id="adminPanelWrapper" style="display: none;">
  <section id="adminLoginSection">
    <h2>Admin Login</h2>
    <form id="adminLogin" onsubmit="adminAuth(event)">
      <label for="adminUser">Username</label>
      <input id="adminUser" placeholder="Admin Username" required type="text" />
      <label for="adminPass">Password</label>
      <input id="adminPass" placeholder="Admin Password" required type="password" />
      <button class="btn">Login</button>
    </form>
    <div id="adminLoginMessage"></div>
    <p style="text-align: center; margin-top: 1em;">
      <a onclick="showUserPanel()" style="color: var(--dark-pink); cursor: pointer;">Back to Services</a>
    </p>
  </section>

<!-- 🔽 Admin Dashboard (this will be shown after login) -->
<section id="adminPanel" class="hidden">
  <div class="admin-section-card">
    <div class="logout-link" onclick="logoutAdmin()">Logout</div>
    <h2>Admin Panel</h2>
    <div class="admin-actions">
      <div class="admin-card">
        <h3>Services</h3>
        <p>Manage your salon services</p>
        <button class="btn" onclick="showServiceManager()">Manage Services</button>
      </div>
      <div class="admin-card">
        <h3>Bookings</h3>
        <p>View and manage appointments</p>
        <button class="btn" onclick="showBookingManager()">View Bookings</button>
      </div>
      <div class="admin-card">
        <h3>Business Settings</h3>
        <p>Manage hours and logo</p>
        <button class="btn" onclick="showBusinessSettings()">Business Settings</button>
      </div>
    </div>
  </div>
</section>
<!-- 🔼 END: Admin Panel Wrapper -->

<!-- 🔄 START: Service Manager -->
<div class="hidden" id="serviceManager">
  <div class="admin-section-card">
    <button class="back-btn" onclick="showAdminDashboard()">Back to Dashboard</button>
    <h3>Manage Services</h3>
    <form id="addServiceForm" onsubmit="addService(event)">
      <h4>Add New Service</h4>
      <div class="form-row">
        <div>
          <label for="serviceName">Service Name</label>
          <input id="serviceName" required type="text" />
        </div>
        <div>
          <label for="serviceCategory">Category</label>
          <input id="serviceCategory" required type="text" />
        </div>
      </div>
      <div class="form-row">
        <div>
          <label for="servicePrice">Price (AED)</label>
          <input id="servicePrice" min="0" required step="0.01" type="number" />
        </div>
        <div>
          <label for="serviceDuration">Duration (mins)</label>
          <input id="serviceDuration" min="5" required step="5" type="number" />
        </div>
      </div>
      <label for="serviceDescription">Description</label>
      <textarea id="serviceDescription" rows="2"></textarea>
      <button class="btn" type="submit">Add Service</button>
    </form>

    <div id="editServiceForm" style="display: none;"></div>

    <h4 style="margin-top: 2em;">Current Services</h4>
    <table class="admin-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Category</th>
          <th>Price</th>
          <th>Duration</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="adminServiceList"></tbody>
    </table>
  </div>
</div>
<!-- 🔄 END: Service Manager -->

<!-- 🔄 START: Booking Manager -->
<div class="hidden" id="bookingManager">
  <div class="admin-section">
    <button class="back-btn" onclick="showAdminDashboard()">Back to Dashboard</button>
    <h3>Booking Management</h3>
    <table class="admin-table">
      <thead>
        <tr>
          <th>Date & Time</th>
          <th>Client</th>
          <th>Services</th>
          <th>Total</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="bookingsList"></tbody>
    </table>
  </div>
</div>
<!-- 🔄 END: Booking Manager -->

<!-- 🔄 START: Business Settings -->
<div class="hidden" id="businessSettings">
  <div class="admin-section-card">
    <button class="back-btn" onclick="showAdminDashboard()">Back to Dashboard</button>
    <h3>Business Settings</h3>

    <div class="tab-container">
      <div class="tab-buttons">
        <button class="tab-button active" onclick="openTab(event, 'hoursTab')">Business Hours</button>
        <button class="tab-button" onclick="openTab(event, 'logoTab')">Company Logo</button>
        <button class="tab-button" onclick="openTab(event, 'emailTab')">Email Settings</button>
      </div>

      <div class="tab-panel active" id="hoursTab">
        <h4>Set Business Hours</h4>
        <form id="businessHoursForm" onsubmit="saveBusinessHours(event)">
          <div class="form-row">
            <div>
              <label for="appointmentInterval">Appointment Interval (minutes)</label>
              <select id="appointmentInterval" required>
                <option disabled selected value="">Select an option</option>
                <option value="15">15 minutes</option>
                <option value="30">30 minutes</option>
                <option value="60">60 minutes</option>
              </select>
            </div>
          </div>
          <table class="business-hours-table">
            <thead>
              <tr>
                <th>Day</th>
                <th>Open</th>
                <th>Close</th>
                <th>Closed</th>
              </tr>
            </thead>
            <tbody id="businessHoursTableBody"></tbody>
          </table>
          <button class="btn" type="submit">Save Business Hours</button>
        </form>
        <div id="hoursMessage"></div>
      </div>

      <div class="tab-panel" id="logoTab">
        <h4>Upload Company Logo</h4>
        <div class="logo-upload-container">
          <input accept="image/*" id="logoUpload" type="file" />
          <div>
            <h5>Logo Preview</h5>
            <div class="logo-preview" id="logoPreview">
              <p>No logo uploaded</p>
            </div>
          </div>
          <button class="btn" onclick="saveLogo()">Save Logo</button>
        </div>
        <div id="logoMessage"></div>
      </div>

      <div class="tab-panel" id="emailTab">
        <h4>Email Notification Settings</h4>
        <div class="email-settings">
          <div class="env-warning">
            <strong>Note:</strong> For production use, you'll need to set up a server-side component to handle emails securely.
          </div>
          <div class="email-toggle">
            <label class="switch">
              <input checked id="customerEmailToggle" type="checkbox" />
              <span class="slider"></span>
            </label>
            <label for="customerEmailToggle">Send confirmation emails to customers</label>
          </div>
          <div class="email-toggle">
            <label class="switch">
              <input checked id="adminEmailToggle" type="checkbox" />
              <span class="slider"></span>
            </label>
            <label for="adminEmailToggle">Send notification emails to admin</label>
          </div>
          <div class="form-row">
            <div>
              <label for="adminEmail">Admin Email Address</label>
              <input id="adminEmail" placeholder="Admin email for notifications" type="email" value="nailsk2022@gmail.com" />
            </div>
          </div>
          <button class="btn" onclick="saveEmailSettings()">Save Email Settings</button>
          <div id="emailSettingsMessage"></div>
        </div>

        <div class="email-settings">
          <h4>Test Email Functionality</h4>
          <p>Send a test email to verify your email settings are working correctly.</p>
          <div class="form-row">
            <div>
              <label for="testEmail">Email Address</label>
              <input id="testEmail" placeholder="Enter email for test" type="email" />
            </div>
          </div>
          <button class="btn" onclick="sendTestEmail()">Send Test Email</button>
          <div id="testEmailMessage"></div>
</div>
          <div id="adminPanelWrapper" style="display: none;">
  <!-- 🔑 Admin Login Section -->
  <section id="adminLoginSection">
    <h2>Admin Login</h2>
    <form id="adminLogin" onsubmit="adminAuth(event)">
      <label for="adminUser">Username</label>
      <input id="adminUser" placeholder="Admin Username" required type="text" />
      <label for="adminPass">Password</label>
      <input id="adminPass" placeholder="Admin Password" required type="password" />
      <button class="btn">Login</button>
    </form>
    <div id="adminLoginMessage"></div>
    <p style="text-align: center; margin-top: 1em;">
      <a onclick="showUserPanel()" style="color: var(--dark-pink); cursor: pointer;">Back to Services</a>
    </p>
  </section>

  <!-- 📋 Admin Dashboard -->
  <section id="adminPanel" class="hidden">
    <div class="admin-section-card">
      <div class="logout-link" onclick="logoutAdmin()">Logout</div>
      <h2>Admin Panel</h2>
      <div class="admin-actions">
        <div class="admin-card">
          <h3>Services</h3>
          <p>Manage your salon services</p>
          <button class="btn" onclick="showServiceManager()">Manage Services</button>
        </div>
        <div class="admin-card">
          <h3>Bookings</h3>
          <p>View and manage appointments</p>
          <button class="btn" onclick="showBookingManager()">View Bookings</button>
        </div>
        <div class="admin-card">
          <h3>Business Settings</h3>
          <p>Manage hours and logo</p>
          <button class="btn" onclick="showBusinessSettings()">Business Settings</button>
        </div>
      </div>
    </div>
  </section>
</div>

<footer>
<p>© 2025 Yes to Nails. All rights reserved.</p>
</footer>
<script>
    // Configuration
    const CONFIG = {
      // EmailJS configuration
      EMAILJS_PUBLIC_KEY: "X4BsAVt7IRjazbu8C",
      EMAILJS_SERVICE_ID: "service_7ge36du",
      EMAILJS_TEMPLATE_ID: "template_u8eo57n",
      EMAILJS_ADMIN_TEMPLATE_ID: "template_hkeuj4m", // You can create a separate template for admin notifications
      IS_PRODUCTION: false, // Will be set based on environment detection
      ADMIN_USERNAME: "admin", // In production, this would be stored securely
      ADMIN_PASSWORD: "admin123", // In production, this would be hashed and stored securely
      ADMIN_EMAIL: "nailsk2022@gmail.com" // Default admin email
    };

    // Sample data
    let services = [
      { id: 1, name: "Classic Manicure", category: "Manicure", price: 60, duration: 30, description: "Nail shaping, cuticle care, and polish" },
      { id: 2, name: "Gel Manicure", category: "Manicure", price: 90, duration: 45, description: "Long-lasting gel polish with nail care" },
      { id: 3, name: "Classic Pedicure", category: "Pedicure", price: 80, duration: 45, description: "Foot soak, scrub, nail care, and polish" },
      { id: 4, name: "Gel Pedicure", category: "Pedicure", price: 110, duration: 60, description: "Foot care with long-lasting gel polish" },
      { id: 5, name: "Nail Art - Simple", category: "Nail Art", price: 30, duration: 15, description: "Basic designs like dots, lines, or glitter" },
      { id: 6, name: "Nail Art - Complex", category: "Nail Art", price: 60, duration: 30, description: "Detailed designs, multiple colors, or 3D elements" },
      { id: 7, name: "Acrylic Full Set", category: "Extensions", price: 180, duration: 90, description: "Full set of acrylic nail extensions" },
      { id: 8, name: "Acrylic Fill", category: "Extensions", price: 100, duration: 60, description: "Maintenance for existing acrylic nails" },
      { id: 9, name: "Nail Repair", category: "Treatments", price: 20, duration: 15, description: "Fix for broken or damaged nails" },
      { id: 10, name: "Paraffin Treatment", category: "Treatments", price: 40, duration: 20, description: "Moisturizing wax treatment for hands or feet" }
    ];

    let cart = [];
    let bookings = [];
    let bookedTimeSlots = {}; // Format: { "YYYY-MM-DD": [{ start: "HH:MM", end: "HH:MM" }] }

    // Default business hours
    let businessHours = {
      interval: 15, // 15-minute intervals
      days: {
        monday: { open: "09:00", close: "18:00", closed: false },
        tuesday: { open: "09:00", close: "18:00", closed: false },
        wednesday: { open: "09:00", close: "18:00", closed: false },
        thursday: { open: "09:00", close: "18:00", closed: false },
        friday: { open: "09:00", close: "18:00", closed: false },
        saturday: { open: "09:00", close: "18:00", closed: false },
        sunday: { open: "09:00", close: "18:00", closed: true }
      }
    };

    // Email settings
    let emailSettings = {
      sendToCustomers: true,
      sendToAdmin: true,
      adminEmail: CONFIG.ADMIN_EMAIL
    };

    // Initialize the page - moved to bottom with Google Sheets integration

    // Detect environment (GitHub Pages, localhost, etc.)
    function detectEnvironment() {
      const hostname = window.location.hostname;
      
      // Check if we're on GitHub Pages
      if (false) {
        CONFIG.IS_PRODUCTION = true;
        document.getElementById('envWarning').style.display = 'none';
        console.log('Running on GitHub Pages - Email functionality will be simulated');
      } 
      // Check if we're on a production domain
      else if (!hostname.includes('localhost') && !hostname.includes('127.0.0.1')) {
        CONFIG.IS_PRODUCTION = true;
      }
      // Local development
      else {
        console.log('Running in development mode');
      }
    }

    // Initialize EmailJS
    function initializeEmailJS() {
      if (CONFIG.EMAILJS_PUBLIC_KEY) {
        emailjs.init(CONFIG.EMAILJS_PUBLIC_KEY);
      }

    // Load data from localStorage
    function loadDataFromStorage() {
      // Use a prefix for all storage keys to avoid conflicts
      const prefix = 'yestonails_';
      
      // Load services
      const savedServices = localStorage.getItem(`${prefix}services`);
      if (savedServices) {
        services = JSON.parse(savedServices);
      }
      
      // Load bookings
      const savedBookings = localStorage.getItem(`${prefix}bookings`);
      if (savedBookings) {
        bookings = JSON.parse(savedBookings);
      }
      
      // Load booked time slots
      const savedTimeSlots = localStorage.getItem(`${prefix}bookedTimeSlots`);
      if (savedTimeSlots) {
        bookedTimeSlots = JSON.parse(savedTimeSlots);
      }
      
      // Load business hours
      const savedBusinessHours = localStorage.getItem(`${prefix}businessHours`);
      if (savedBusinessHours) {
        businessHours = JSON.parse(savedBusinessHours);
      }
      
      // Load email settings
      const savedEmailSettings = localStorage.getItem(`${prefix}emailSettings`);
      if (savedEmailSettings) {
        emailSettings = JSON.parse(savedEmailSettings);
      } else {
        // Set default admin email if not saved before
        emailSettings.adminEmail = CONFIG.ADMIN_EMAIL;
      }
    }

    // Save data to localStorage
    function saveDataToStorage() {
      const prefix = 'yestonails_';
      
      localStorage.setItem(`${prefix}services`, JSON.stringify(services));
      localStorage.setItem(`${prefix}bookings`, JSON.stringify(bookings));
      localStorage.setItem(`${prefix}bookedTimeSlots`, JSON.stringify(bookedTimeSlots));
      localStorage.setItem(`${prefix}businessHours`, JSON.stringify(businessHours));
      localStorage.setItem(`${prefix}emailSettings`, JSON.stringify(emailSettings));
    }

    // Display logo from localStorage
    function displayLogo() {
      const logoData = `<img src="https://i.ibb.co/S4Fpz82j/f05e25c8-c78a-401d-ac52-cd2f4d7423c1.png" alt="f05e25c8-c78a-401d-ac52-cd2f4d7423c1" border="0">`;
      const logoContainer = document.getElementById('logoContainer');
      
      if (logoData) {
        logoContainer.innerHTML = logoData;
      } else {
        // Default SVG logo
        logoContainer.innerHTML = `
          <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="45" fill="#fff" />
            <path d="M30,40 Q50,20 70,40 Q90,60 70,80 Q50,100 30,80 Q10,60 30,40 Z" fill="#ff99cc" />
            <text x="50" y="55" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="#fff">YES TO</text>
            <text x="50" y="70" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#fff">NAILS</text>
          </svg>
        `;
      }
    }

    // Populate services list
function populateServices() {
  const container = document.getElementById('services');
  container.innerHTML = '';
  services.forEach(service => {
    const div = document.createElement('div');
    div.className = 'service-card';
    div.innerHTML = `
      <h3>${service.name}</h3>
      <p>${service.category}</p>
      <p>${service.description}</p>
      <p>AED ${service.price} – ${service.duration} mins</p>
      <button onclick='addToCart(${JSON.stringify(service)})'>Add</button>
    `;
    container.appendChild(div);
  });
}


    // Populate category filter
    function populateCategories() {
      const categoryFilter = document.getElementById('categoryFilter');
      categoryFilter.innerHTML = '<option value="all">All Categories</option>';
      
      const categories = [...new Set(services.map(service => service.category))];
      
      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categoryFilter.appendChild(option);
      });
    }

    // Filter services by category
    function filterServices() {
      const category = document.getElementById('categoryFilter').value;
      populateServices(category);
    }

    // Add service to cart
 function addToCart(serviceId) {
  const service = services.find(s => s.id === serviceId);
  if (service) {
    cart.push({ ...service });
    updateCart();
    // Regenerate time slots if date is already selected
    const selectedDate = document.getElementById('bookingDate').value;
    if (selectedDate) {
      window.showTimeSlots();  // ✅ Correct main function
    }
  }
}

// Remove service from cart
function removeFromCart(index) {
  cart.splice(index, 1);
  updateCart();
  // Regenerate time slots if date is already selected
  const selectedDate = document.getElementById('bookingDate').value;
  if (selectedDate) {
    window.showTimeSlots();  // ✅ Corrected function call
  }
}
    // Update cart display
    function updateCart() {
      const cartElement = document.getElementById('cart');
      const totalDuration = document.getElementById('totalDuration');
      const totalPrice = document.getElementById('totalPrice');
      
      if (cart.length === 0) {
        cartElement.innerHTML = '<p class="cart-empty">Your selection is empty. Add services from the list.</p>';
        totalDuration.textContent = '0 mins';
        totalPrice.textContent = '0.00';
        return;
      }
      
      cartElement.innerHTML = '';
      let duration = 0;
      let price = 0;
      
      cart.forEach((item, index) => {
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
          <div>
            <div>${item.name}</div>
            <div class="service-details">${item.duration} mins | AED ${item.price.toFixed(2)}</div>
          </div>
          <button class="remove-btn" onclick="removeFromCart(${index})">Remove</button>
        `;
        cartElement.appendChild(cartItem);
        
        duration += item.duration;
        price += item.price;
      });
      
      totalDuration.textContent = `${duration} mins`;
      totalPrice.textContent = price.toFixed(2);
    }

    // Get day of week from date
    function getDayOfWeek(dateString) {
      const date = new Date(dateString);
      const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
      return days[date.getDay()];
    }

     
      if (!selectedDate) {
        timeSlotsContainer.innerHTML = '<p>Please select a date first</p>';
        return;
      }
      
      if (cart.length === 0) {
        timeSlotsContainer.innerHTML = '<p>Please add services to your selection first</p>';
        return;
      }
      
      // Get day of week
      const dayOfWeek = getDayOfWeek(selectedDate);
      const daySettings = businessHours.days[dayOfWeek];
      
      // Check if salon is closed on selected day
      if (daySettings.closed) {
        timeSlotsContainer.innerHTML = '<p>Sorry, we are closed on this day. Please select another date.</p>';
        return;
      }
      
      // Calculate total duration needed for selected services
      const totalDuration = cart.reduce((sum, service) => sum + service.duration, 0);
      
      // Parse business hours
      const openTime = daySettings.open.split(':').map(Number);
      const closeTime = daySettings.close.split(':').map(Number);
      const startHour = openTime[0];
      const startMinute = openTime[1];
      const endHour = closeTime[0];
      const endMinute = closeTime[1];
      
      // Generate all possible time slots for the day
      const slots = [];
      const interval = parseInt(businessHours.interval);
      
      for (let hour = startHour; hour <= endHour; hour++) {
        for (let minute = (hour === startHour ? startMinute : 0); 
             minute < (hour === endHour ? endMinute : 60); 
             minute += interval) {
          
          const startTime = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
          
          // Calculate end time based on total duration
          const startMinutes = hour * 60 + minute;
          const endMinutes = startMinutes + totalDuration;
          
          // Skip if appointment would end after business hours
          if (endMinutes > endHour * 60 + endMinute) continue;
          
          const endHourVal = Math.floor(endMinutes / 60);
          const endMinuteVal = endMinutes % 60;
          const endTime = `${endHourVal.toString().padStart(2, '0')}:${endMinuteVal.toString().padStart(2, '0')}`;
          
          slots.push({ start: startTime, end: endTime });
        }
      }
      
      // Filter out already booked slots
      const bookedSlots = bookedTimeSlots[selectedDate] || [];
      const availableSlots = slots.filter(slot => {
        // Check if this slot overlaps with any booked slot
        return !bookedSlots.some(bookedSlot => {
          // Convert times to minutes for easier comparison
          const slotStart = timeToMinutes(slot.start);
          const slotEnd = timeToMinutes(slot.end);
          const bookedStart = timeToMinutes(bookedSlot.start);
          const bookedEnd = timeToMinutes(bookedSlot.end);
          
          // Check for overlap
          return (slotStart < bookedEnd && slotEnd > bookedStart);
        });
      });
      
      // Display available time slots
      timeSlotsContainer.innerHTML = '';
      if (availableSlots.length === 0) {
        timeSlotsContainer.innerHTML = '<p>No available time slots for this date. Please select another date.</p>';
        return;
      }
      
      availableSlots.forEach(slot => {
        const slotElement = document.createElement('div');
        slotElement.className = 'time-slot';
        slotElement.textContent = `${slot.start} - ${slot.end}`;
        slotElement.dataset.start = slot.start;
        slotElement.dataset.end = slot.end;
        
        slotElement.addEventListener('click', function() {
          // Remove selected class from all slots
          document.querySelectorAll('.time-slot').forEach(el => el.classList.remove('selected'));
          // Add selected class to this slot
          this.classList.add('selected');
          // Store selected time in hidden input
          document.getElementById('selectedTime').value = JSON.stringify(slot);
        });
        
        timeSlotsContainer.appendChild(slotElement);
      });
    }

    // Helper function to convert time string to minutes
    function timeToMinutes(timeStr) {
      const [hours, minutes] = timeStr.split(':').map(Number);
      return hours * 60 + minutes;
    }

    // Format date for display
    function formatDate(dateString) {
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      return new Date(dateString).toLocaleDateString(undefined, options);
    }

    // Send email using EmailJS
    function sendEmail(templateParams, isAdminNotification = false, onSuccess, onError) {
      // Determine which template to use
      const templateId = isAdminNotification ? CONFIG.EMAILJS_ADMIN_TEMPLATE_ID : CONFIG.EMAILJS_TEMPLATE_ID;
      
      // Check if we're in production with email configured
      if (CONFIG.EMAILJS_PUBLIC_KEY) {
        // Use EmailJS if configured
        emailjs.send(CONFIG.EMAILJS_SERVICE_ID, templateId, templateParams)
          .then(function(response) {
            console.log('Email sent successfully:', response);
            if (onSuccess) onSuccess(response);
          }, function(error) {
            console.error('Email failed to send:', error);
            if (onError) onError(error);
          });
      } 
      // For GitHub Pages or when email isn't configured
      else {
        // Simulate email sending
        console.log(`${isAdminNotification ? 'Admin notification' : 'Customer email'} would be sent with params:`, templateParams);
        setTimeout(() => {
          if (onSuccess) onSuccess({status: 200, text: 'Email simulated'});
        }, 1000);
      }
    }

    // Submit booking
    function submitBooking(event) {
      event.preventDefault();
      
      if (cart.length === 0) {
        document.getElementById('confirmation').innerHTML = `
          <div class="error-box">Please select at least one service before booking.</div>
        `;
        return;
      }
      
      const selectedTimeValue = document.getElementById('selectedTime').value;
      if (!selectedTimeValue) {
        document.getElementById('confirmation').innerHTML = `
          <div class="error-box">Please select a time slot for your appointment.</div>
        `;
        return;
      }
      
      // Show loading state
      const submitBtn = document.getElementById('bookingSubmitBtn');
      const originalBtnText = submitBtn.innerHTML;
      submitBtn.innerHTML = 'Processing... <span class="loading-spinner"></span>';
      submitBtn.disabled = true;
      
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const date = document.getElementById('bookingDate').value;
      const notes = document.getElementById('notes').value;
      const selectedTime = JSON.parse(selectedTimeValue);
      
      const totalPrice = cart.reduce((sum, item) => sum + item.price, 0);
      const totalDuration = cart.reduce((sum, item) => sum + item.duration, 0);
      
      const booking = {
        id: Date.now(),
        name,
        email,
        phone,
        date,
        time: selectedTime,
        notes,
        services: [...cart],
        totalPrice,
        totalDuration,
        status: 'Pending'
      };
      
      // Add booking to the list
      bookings.push(booking);
      
      // Block the time slot
      if (!bookedTimeSlots[date]) {
        bookedTimeSlots[date] = [];
      }
      bookedTimeSlots[date].push(selectedTime);
      
      // Save data to localStorage
      saveDataToStorage();
      
      // Prepare services list for email
      const servicesList = booking.services.map(s => `${s.name} (${s.duration} mins) - AED ${s.price.toFixed(2)}`).join('<br>');
      
      // Send confirmation email to customer if enabled
      if (emailSettings.sendToCustomers) {
        const customerParams = {
          to_name: name,
          to_email: email,
          booking_date: formatDate(date),
          booking_time: `${selectedTime.start} - ${selectedTime.end}`,
          services_list: servicesList,
          total_price: `AED ${totalPrice.toFixed(2)}`,
          total_duration: `${totalDuration} mins`,
          booking_id: booking.id,
          notes: notes || 'None'
        };
        
        sendEmail(customerParams, false);
      }
      
      // Send notification email to admin
      // Always send to nailsk2022@gmail.com regardless of admin email settings
      const adminParams = {
        to_name: 'Admin',
        to_email: 'nailsk2022@gmail.com', // Hard-coded admin email
        customer_name: name,
        customer_email: email,
        customer_phone: phone,
        booking_date: formatDate(date),
        booking_time: `${selectedTime.start} - ${selectedTime.end}`,
        services_list: servicesList,
        total_price: `AED ${totalPrice.toFixed(2)}`,
        total_duration: `${totalDuration} mins`,
        booking_id: booking.id,
        notes: notes || 'None'
      };
      
      sendEmail(adminParams, true);
      
      // Show confirmation and reset form after a short delay
      setTimeout(() => {
        document.getElementById('confirmation').innerHTML = `
          <div class="confirmation-box">
            <h3>Booking Confirmed!</h3>
            <p>Thank you, ${name}. Your appointment has been scheduled for ${formatDate(date)} at ${selectedTime.start}.</p>
            <p>We'll send a confirmation to ${email}.</p>
            ${CONFIG.EMAILJS_PUBLIC_KEY ? '' : '<p><small>Note: In this demo version, emails are simulated and not actually sent.</small></p>'}
          </div>
        `;
        
        // Reset form and cart
        document.getElementById('bookingForm').reset();
        document.getElementById('selectedTime').value = '';
        document.getElementById('timeSlots').innerHTML = '<p>Please select a date first</p>';
        cart = [];
        updateCart();
        

  if (username === CONFIG.ADMIN_USERNAME && password === CONFIG.ADMIN_PASSWORD) {
    // Show admin panel and hide login
    document.getElementById('adminLoginSection').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    document.getElementById('adminPanelWrapper').style.display = 'block';
    document.getElementById('userPanel').style.display = 'none';

    showAdminDashboard();
    loadBusinessHoursToForm();
    loadEmailSettings();
  } else {
    document.getElementById('adminLoginMessage').innerHTML = `
      <div class="error-box">Invalid username or password.</div>
    `;
  }
}
   function logoutAdmin() {
  document.getElementById('adminLoginSection').classList.remove('hidden');
  document.getElementById('adminPanel').classList.add('hidden');
  document.getElementById('adminLogin').reset();
  document.getElementById('adminLoginMessage').innerHTML = '';
}
window.logoutAdmin = logoutAdmin;



function showAdminLogin() {
  document.getElementById('userPanel').style.display = 'none';
  document.getElementById('adminPanelWrapper').style.display = 'block';

  // Fix: Ensure login section is shown and dashboard is hidden initially
  document.getElementById('adminLoginSection').classList.remove('hidden');
  document.getElementById('adminPanel').classList.add('hidden');
}

    // Show user panel
    function showUserPanel() {
      document.getElementById('userPanel').style.display = 'grid';
      document.getElementById('adminPanelWrapper').style.display = 'none';
    }

    // Show admin dashboard
    function showAdminDashboard() {
      document.getElementById('serviceManager').classList.add('hidden');
      document.getElementById('bookingManager').classList.add('hidden');
      document.getElementById('businessSettings').classList.add('hidden');
    }

    // Show service manager
    function showServiceManager() {
      document.getElementById('serviceManager').classList.remove('hidden');
      document.getElementById('bookingManager').classList.add('hidden');
      document.getElementById('businessSettings').classList.add('hidden');
      populateAdminServiceList();
    }

    // Show booking manager
    function showBookingManager() {
      document.getElementById('serviceManager').classList.add('hidden');
      document.getElementById('bookingManager').classList.remove('hidden');
      document.getElementById('businessSettings').classList.add('hidden');
      populateBookingsList();
    }

    // Show business settings
    function showBusinessSettings() {
      document.getElementById('serviceManager').classList.add('hidden');
      document.getElementById('bookingManager').classList.add('hidden');
      document.getElementById('businessSettings').classList.remove('hidden');
      loadBusinessHoursToForm();
      loadEmailSettings();
    }

    // Open tab in business settings
    function openTab(event, tabId) {
      // Hide all tab panels
      const tabPanels = document.getElementsByClassName('tab-panel');
      for (let i = 0; i < tabPanels.length; i++) {
        tabPanels[i].classList.remove('active');
      }
      
      // Remove active class from all tab buttons
      const tabButtons = document.getElementsByClassName('tab-button');
      for (let i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove('active');
      }
      
      // Show the selected tab panel
      document.getElementById(tabId).classList.add('active');
      
      // Add active class to the clicked button
      event.currentTarget.classList.add('active');
    }

  async function loadBusinessHoursToForm() {
  try {
    const { data, error } = await supabase
      .from('business_hours')
      .select('day, open_time, close_time');

    if (error) throw error;

    data.forEach(row => {
      const day = row.day.toLowerCase();
      const openInput = document.getElementById(`${day}Open`);
      const closeInput = document.getElementById(`${day}Close`);

      if (openInput && closeInput) {
        openInput.value = row.open_time || '';
        closeInput.value = row.close_time || '';
      }
    });
  } catch (err) {
    console.error('Error loading business hours:', err);
  }
}


    // Load email settings to form
    function loadEmailSettings() {
      document.getElementById('customerEmailToggle').checked = emailSettings.sendToCustomers;
      document.getElementById('adminEmailToggle').checked = emailSettings.sendToAdmin;
      document.getElementById('adminEmail').value = emailSettings.adminEmail || CONFIG.ADMIN_EMAIL;
    }

    // Save business hours
    async function saveBusinessHours(event) {
  event.preventDefault();

  const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
  const updates = [];

  for (const day of days) {
    const open = document.getElementById(`${day.toLowerCase()}Open`).value;
    const close = document.getElementById(`${day.toLowerCase()}Close`).value;

    updates.push({ day, open_time: open, close_time: close });
  }

  try {
    for (const row of updates) {
      await supabase
        .from('business_hours')
        .update({
          open_time: row.open_time,
          close_time: row.close_time
        })
        .eq('day', row.day);
    }

    document.getElementById('hoursMessage').innerHTML = `
      <div class="success-message">Business hours updated successfully.</div>
    `;
    setTimeout(() => {
      document.getElementById('hoursMessage').innerHTML = '';
    }, 3000);
  } catch (error) {
    console.error('Error saving business hours:', error);
    alert('Failed to save business hours');
  }
}
   async function saveEmailSettings() {
  const sendToCustomers = document.getElementById('customerEmailToggle').checked;
  const sendToAdmin = document.getElementById('adminEmailToggle').checked;
  const adminEmail = document.getElementById('adminEmail').value || CONFIG.ADMIN_EMAIL;

  try {
    const { error } = await supabase
      .from('email_settings')
      .update({
        send_to_customers: sendToCustomers,
        send_to_admin: sendToAdmin,
        admin_email: adminEmail
      })
      .eq('id', 1); // assuming you have a single row with id=1

    if (error) throw error;

    document.getElementById('emailSettingsMessage').innerHTML = `
      <div class="success-message">Email settings saved successfully!</div>
    `;

    setTimeout(() => {
      document.getElementById('emailSettingsMessage').innerHTML = '';
    }, 3000);
  } catch (err) {
    console.error("Failed to save email settings:", err);
    alert("Failed to save email settings.");
  }
}

    // Send test email
    function sendTestEmail() {
      const testEmail = document.getElementById('testEmail').value;
      
      if (!testEmail) {
        document.getElementById('testEmailMessage').innerHTML = `
          <div class="error-box">Please enter an email address for testing.</div>
        `;
        return;
      }
      
      document.getElementById('testEmailMessage').innerHTML = `
        <div class="success-message">Sending test email... <span class="loading-spinner"></span></div>
      `;
      
      const testParams = {
        to_name: 'Test User',
        to_email: testEmail,
        booking_date: 'Test Date',
        booking_time: 'Test Time',
        services_list: 'Test Service 1<br>Test Service 2',
        total_price: 'AED 100.00',
        total_duration: '60 mins',
        booking_id: 'TEST-123',
        notes: 'This is a test email to verify email functionality.'
      };
      
      sendEmail(testParams, false,
        function(response) {
          document.getElementById('testEmailMessage').innerHTML = `
            <div class="success-message">Test email sent successfully!</div>
            ${CONFIG.EMAILJS_PUBLIC_KEY ? '' : '<p><small>Note: In this demo version, emails are simulated and not actually sent.</small></p>'}
          `;
          setTimeout(() => {
            document.getElementById('testEmailMessage').innerHTML = '';
          }, 3000);
        },
        function(error) {
          document.getElementById('testEmailMessage').innerHTML = `
            <div class="error-box">Failed to send test email. Error: ${error.text}</div>
          `;
        }
      );
    }

    // Save logo
    function saveLogo() {
      const fileInput = document.getElementById('logoUpload');
      if (fileInput.files.length === 0) {
        document.getElementById('logoMessage').innerHTML = `
          <div class="error-box">Please select a logo file first.</div>
        `;
        return;
      }
      
      const file = fileInput.files[0];
      const reader = new FileReader();
      
      reader.onload = function(e) {
        const logoData = e.target.result;
        localStorage.setItem('yestonails_logo', logoData);
        
        document.getElementById('logoMessage').innerHTML = `
          <div class="success-message">Logo saved successfully!</div>
        `;
        
        // Update logo in header
        displayLogo();
        
        setTimeout(() => {
          document.getElementById('logoMessage').innerHTML = '';
        }, 3000);
      };
      
      reader.readAsDataURL(file);
    }

    // Populate admin service list
async function populateAdminServiceList() {
  console.log("📦 populateAdminServiceList called");

  const { data, error } = await supabase.from('services').select('*');

  if (error) {
    console.error("❌ Error loading services:", error);
    return;
  }

  const serviceTable = document.getElementById('adminServiceTableBody');
  serviceTable.innerHTML = '';

  data.forEach(service => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${service.name}</td>
      <td>${service.category}</td>
      <td>${service.duration}</td>
      <td>AED ${service.price.toFixed(2)}</td>
      <td>${service.description || '-'}</td>
    `;
    serviceTable.appendChild(row);
  });
}
window.populateAdminServiceList = populateAdminServiceList;


    // Add new service
    function addService(event) {
      event.preventDefault();
      
      const newService = {
        id: services.length > 0 ? Math.max(...services.map(s => s.id)) + 1 : 1,
        name: document.getElementById('serviceName').value,
        category: document.getElementById('serviceCategory').value,
        price: parseFloat(document.getElementById('servicePrice').value),
        duration: parseInt(document.getElementById('serviceDuration').value),
        description: document.getElementById('serviceDescription').value
      };
      
      services.push(newService);
      document.getElementById('addServiceForm').reset();
      
      // Save to localStorage
      saveDataToStorage();
      
      // Update all UI components
      populateAdminServiceList();
      populateServices();
      populateCategories();
      
      // Show success message
      const form = document.getElementById('addServiceForm');
      const successDiv = document.createElement('div');
      successDiv.className = 'success-message';
      successDiv.textContent = 'Service added successfully!';
      form.appendChild(successDiv);
      
      setTimeout(() => {
        if (successDiv.parentNode) {
          successDiv.parentNode.removeChild(successDiv);
        }
      }, 3000);
    }

    // Edit service
    function editService(serviceId) {
      const service = services.find(s => s.id === serviceId);
      if (!service) return;
      
      // Hide the add service form and show edit form
      document.getElementById('addServiceForm').style.display = 'none';
      
      // Create edit form if it doesn't exist
      let editForm = document.getElementById('editServiceForm');
      if (!editForm) {
        editForm = document.createElement('div');
        editForm.id = 'editServiceForm';
        editForm.innerHTML = `
          <h4>Edit Service</h4>
          <form onsubmit="updateService(event)">
            <input type="hidden" id="editServiceId">
            <div class="form-row">
              <div>
                <label for="editServiceName">Service Name</label>
                <input type="text" id="editServiceName" required>
              </div>
              <div>
                <label for="editServiceCategory">Category</label>
                <input type="text" id="editServiceCategory" required>
              </div>
            </div>
            <div class="form-row">
              <div>
                <label for="editServicePrice">Price (AED)</label>
                <input type="number" id="editServicePrice" min="0" step="0.01" required>
              </div>
              <div>
                <label for="editServiceDuration">Duration (mins)</label>
                <input type="number" id="editServiceDuration" min="5" step="5" required>
              </div>
            </div>
            <label for="editServiceDescription">Description</label>
            <textarea id="editServiceDescription" rows="2"></textarea>
            <div style="display: flex; gap: 1em; margin-top: 1em;">
              <button type="submit" class="btn">Update Service</button>
              <button type="button" class="back-btn" onclick="cancelEditService()">Cancel</button>
            </div>
          </form>
        `;
        
        // Insert edit form after the add service form
        const addForm = document.getElementById('addServiceForm');
        addForm.parentNode.insertBefore(editForm, addForm.nextSibling);
      }
      
      // Populate the edit form with service data
      document.getElementById('editServiceId').value = service.id;
      document.getElementById('editServiceName').value = service.name;
      document.getElementById('editServiceCategory').value = service.category;
      document.getElementById('editServicePrice').value = service.price;
      document.getElementById('editServiceDuration').value = service.duration;
      document.getElementById('editServiceDescription').value = service.description || '';
      
      // Show edit form
      editForm.style.display = 'block';
      
      // Scroll to edit form
      editForm.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Update service
    function updateService(event) {
      event.preventDefault();
      
      const serviceId = parseInt(document.getElementById('editServiceId').value);
      const serviceIndex = services.findIndex(s => s.id === serviceId);
      
      if (serviceIndex === -1) return;
      
      // Update the service
      services[serviceIndex] = {
        id: serviceId,
        name: document.getElementById('editServiceName').value,
        category: document.getElementById('editServiceCategory').value,
        price: parseFloat(document.getElementById('editServicePrice').value),
        duration: parseInt(document.getElementById('editServiceDuration').value),
        description: document.getElementById('editServiceDescription').value
      };
      
      // Save to localStorage
      saveDataToStorage();
      
      // Update all UI components
      populateAdminServiceList();
      populateServices();
      populateCategories();
      
      // Hide edit form and show add form
      cancelEditService();
      
      // Show success message
      const serviceManager = document.getElementById('serviceManager');
      const successDiv = document.createElement('div');
      successDiv.className = 'success-message';
      successDiv.textContent = 'Service updated successfully!';
      serviceManager.insertBefore(successDiv, serviceManager.firstChild);
      
      setTimeout(() => {
        if (successDiv.parentNode) {
          successDiv.parentNode.removeChild(successDiv);
        }
      }, 3000);
    }
    
    // Cancel edit service
    function cancelEditService() {
      const editForm = document.getElementById('editServiceForm');
      const addForm = document.getElementById('addServiceForm');
      
      if (editForm) {
        editForm.style.display = 'none';
      }
      if (addForm) {
        addForm.style.display = 'block';
      }
    }

    // Delete service
    function deleteService(serviceId) {
      if (confirm('Are you sure you want to delete this service?')) {
        const serviceName = services.find(s => s.id === serviceId)?.name || 'Service';
        services = services.filter(service => service.id !== serviceId);
        
        // Save to localStorage
        saveDataToStorage();
        
        // Update all UI components
        populateAdminServiceList();
        populateServices();
        populateCategories();
        
        // Show success message
        const serviceManager = document.getElementById('serviceManager');
        const successDiv = document.createElement('div');
        successDiv.className = 'success-message';
        successDiv.textContent = `${serviceName} deleted successfully!`;
        serviceManager.insertBefore(successDiv, serviceManager.firstChild);
        
        setTimeout(() => {
          if (successDiv.parentNode) {
            successDiv.parentNode.removeChild(successDiv);
          }
        }, 3000);
      }
    }

    // Populate bookings list
async function populateBookingsList() {
  console.log("populateBookingsList called (fetch from Supabase)");

  const { data, error } = await supabase.from('bookings').select('*').order('id', { ascending: false });

  const bookingsList = document.getElementById('bookingsList');
  bookingsList.innerHTML = '';

  if (error) {
    console.error("Error fetching bookings:", error);
    bookingsList.innerHTML = '<tr><td colspan="6">Failed to load bookings.</td></tr>';
    return;
  }

  if (!data || data.length === 0) {
    bookingsList.innerHTML = '<tr><td colspan="6">No bookings found.</td></tr>';
    return;
  }

  data.forEach(booking => {
    const services = JSON.parse(booking.services || '[]');
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${booking.date}<br>${booking.time_start} - ${booking.time_end}</td>
      <td>${booking.name}<br><small>${booking.phone}</small><br><small>${booking.email}</small></td>
      <td>${services.map(s => s.name).join(', ')}</td>
      <td>AED ${booking.total_price}<br>${booking.total_duration} mins</td>
      <td>${booking.status}</td>
      <td>
        <button class="btn" onclick="updateBookingStatus(${booking.id}, 'Confirmed')">Confirm</button>
        <button class="remove-btn" onclick="updateBookingStatus(${booking.id}, 'Cancelled')">Cancel</button>
      </td>
    `;
    bookingsList.appendChild(row);
  });
}




    // Update booking status
    function updateBookingStatus(bookingId, status) {
      const booking = bookings.find(b => b.id === bookingId);
      if (booking) {
        const previousStatus = booking.status;
        booking.status = status;
        
        // If cancelled, free up the time slot
        if (status === 'Cancelled') {
          const date = booking.date;
          if (bookedTimeSlots[date]) {
            bookedTimeSlots[date] = bookedTimeSlots[date].filter(slot => 
              !(slot.start === booking.time.start && slot.end === booking.time.end)
            );
          }
        
        // Save to localStorage
        saveDataToStorage();
        
        // Send status update email if enabled and status changed
        if (previousStatus !== status && emailSettings.sendToCustomers) {
          const statusParams = {
            to_name: booking.name,
            to_email: booking.email,
            booking_date: formatDate(booking.date),
            booking_time: `${booking.time.start} - ${booking.time.end}`,
            booking_status: status,
            booking_id: booking.id,
            services_list: booking.services.map(s => `${s.name} (${s.duration} mins) - AED ${s.price.toFixed(2)}`).join('<br>'),
            total_price: `AED ${booking.totalPrice.toFixed(2)}`
          };
          
          sendEmail(statusParams, false);
          
          // Also send notification to admin
          const adminStatusParams = {
            to_name: 'Admin',
            to_email: 'nailsk2022@gmail.com',
            customer_name: booking.name,
            customer_email: booking.email,
            booking_date: formatDate(booking.date),
            booking_time: `${booking.time.start} - ${booking.time.end}`,
            booking_status: status,
            booking_id: booking.id,
            services_list: booking.services.map(s => `${s.name} (${s.duration} mins) - AED ${s.price.toFixed(2)}`).join('<br>'),
            total_price: `AED ${booking.totalPrice.toFixed(2)}`
          };
          
          sendEmail(adminStatusParams, true);
        }
        
        populateBookingsList();
      }</script>
<!-- Supabase & EmailJS Setup -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script>
  const SUPABASE_URL = 'https://fyphrauehrmotfderfey.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ5cGhyYXVlaHJtb3RmZGVyZmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNzcyMjIsImV4cCI6MjA2Mzg1MzIyMn0.OwrKxqDPYPcBl6D4tsfXlKNIcUlwdmCBb1CaAVUy-K0';
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  let services = [], cart = [], bookings = [];

  function detectEnvironment() {
    console.log("Environment detected.");
  }

  function initializeEmailJS() {
    emailjs.init("X4BsAVt7IRjazbu8C");
  }

  function sendEmail(params, isClient, onSuccess, onError) {
    const templateParams = {
      to_email: isClient ? params.to_email : "nailsk2022@gmail.com",
      to_name: params.to_name,
      booking_date: params.booking_date,
      booking_time: params.booking_time,
      services_list: params.services_list,
      total_price: params.total_price,
      total_duration: params.total_duration,
      booking_id: params.booking_id,
      notes: params.notes,
      from_name: "Yes to Nails",
    };

    emailjs.send("service_o9w7tsb", "template_tn6m5co", templateParams)
      .then(onSuccess)
      .catch(onError);
  }

  async function loadServicesFromSupabase() {
    const { data, error } = await supabase.from('services').select('*');
    if (error) return console.error("Service load error:", error);
    services = data;
    populateServices();
  }

  async function loadBookingsFromSupabase() {
    const { data, error } = await supabase.from('bookings').select('*').order('date', { ascending: false });
    if (error) return console.error("Error loading bookings:", error);
    bookings = data;
    populateBookingsList();
  }

  async function saveBookingToSupabase(booking) {
    const { error } = await supabase.from('bookings').insert([booking]);
    if (error) console.error("Booking save error:", error);
  }

  async function displayLogo() {
    const { data, error } = await supabase.from('business_settings').select('logo_url').eq('id', 1).single();
    if (error) return console.error('Error loading logo:', error);
    if (data?.logo_url) {
      document.getElementById('logoContainer').innerHTML = `<img src="${data.logo_url}" alt="Logo" style="max-height: 100px;">`;
    }
  }

  function populateServices() {
    const container = document.getElementById('services');
    container.innerHTML = '';

    const card = document.createElement('div');
    card.className = 'service-list-card';

    const title = document.createElement('h2');
    title.textContent = 'Browse Services';
    card.appendChild(title);

    const select = document.createElement('select');
    select.id = 'categoryFilter';
    select.innerHTML = `<option value="all">All Categories</option>`;
    [...new Set(services.map(s => s.category))].forEach(cat => {
      const option = document.createElement('option');
      option.value = cat;
      option.textContent = cat;
      select.appendChild(option);
    });
    select.onchange = () => renderFilteredServices(select.value);
    card.appendChild(select);

    const serviceList = document.createElement('div');
    serviceList.id = 'serviceList';
    card.appendChild(serviceList);

    container.appendChild(card);
    renderFilteredServices('all');
  }

  function renderFilteredServices(category) {
    const list = document.getElementById('serviceList');
    list.innerHTML = '';
    const filtered = category === 'all' ? services : services.filter(s => s.category === category);

    filtered.forEach((service, index) => {
      const div = document.createElement('div');
      div.className = 'service-item';
      div.innerHTML = `
        <div class="service-info">
          <p class="service-title">${service.name}</p>
          <span class="service-category">${service.category}</span>
          <p class="service-description">${service.description}</p>
        </div>
        <div class="service-meta">
          <p>${service.duration} mins</p>
          <p>AED ${service.price}</p>
          <button class="add-btn" onclick='addToCartByIndex(${index})'>Add</button>
        </div>
      `;
      list.appendChild(div);
    });
  }
</script>


  function addToCartByIndex(index) {
    addToCart(services[index]);
  }

  function addToCart(service) {
    cart.push(service);
    updateCart();
  }

  function removeFromCart(index) {
    cart.splice(index, 1);
    updateCart();
  }

  function updateCart() {
    const cartContainer = document.getElementById('cart');
    if (!cartContainer) return;

    cartContainer.innerHTML = '';
    let total = 0;
    cart.forEach((item, index) => {
      total += item.price;
      const div = document.createElement('div');
      div.innerHTML = `
        <p>${item.name} - AED ${item.price}</p>
        <button onclick="removeFromCart(${index})">Remove</button>
      `;
      cartContainer.appendChild(div);
    });

    const totalEl = document.createElement('p');
    totalEl.innerHTML = `<strong>Total: AED ${total}</strong>`;
    cartContainer.appendChild(totalEl);
  }

  function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString(undefined, { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
  }

  function populateBookingsList() {
    const bookingsList = document.getElementById('bookingsList');
    bookingsList.innerHTML = '';

    if (bookings.length === 0) {
      const row = document.createElement('tr');
      row.innerHTML = '<td colspan="6" style="text-align: center;">No bookings found.</td>';
      bookingsList.appendChild(row);
      return;
    }

    bookings.forEach(booking => {
      const servicesArray = Array.isArray(booking.services)
        ? booking.services
        : JSON.parse(booking.services || '[]');

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${formatDate(booking.date)}<br>${booking.time_start} - ${booking.time_end}</td>
        <td>${booking.name}<br><small>${booking.phone}</small><br><small>${booking.email}</small></td>
        <td>${servicesArray.map(s => s.name).join(', ')}</td>
        <td>AED ${Number(booking.total_price).toFixed(2)}<br>${booking.total_duration} mins</td>
        <td>${booking.status}</td>
        <td>
          <button class="btn" onclick="updateBookingStatus(${booking.id}, 'Confirmed')">Confirm</button>
          <button class="remove-btn" onclick="updateBookingStatus(${booking.id}, 'Cancelled')">Cancel</button>
        </td>
      `;
      bookingsList.appendChild(row);
    });
  }

  function updateBookingStatus(bookingId, status) {
    const booking = bookings.find(b => b.id === bookingId);
    if (!booking) return;

    booking.status = status;
    populateBookingsList();

    supabase
      .from('bookings')
      .update({ status })
      .eq('id', bookingId)
      .then(({ error }) => {
        if (error) console.error("Failed to update status:", error);
      });
  }

  function submitBooking(event) {
    event.preventDefault();

    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const date = document.getElementById('bookingDate').value;
    const notes = document.getElementById('notes').value;
    const selectedTime = JSON.parse(document.getElementById('selectedTime').value || '{}');

    const totalPrice = cart.reduce((sum, item) => sum + item.price, 0);
    const totalDuration = cart.reduce((sum, item) => sum + item.duration, 0);

    const booking = {
      name,
      email,
      phone,
      date,
      time_start: selectedTime.start,
      time_end: selectedTime.end,
      notes,
      services: JSON.stringify(cart),
      total_price: totalPrice,
      total_duration: totalDuration,
      status: 'Pending'
    };

    saveBookingToSupabase(booking);
    alert("Booking submitted!");
    document.getElementById('bookingForm').reset();
    document.getElementById('selectedTime').value = '';
    cart = [];
    updateCart();
  }

  function showUserPanel() {
    document.getElementById('adminLoginSection')?.classList.add('hidden');
    document.getElementById('userPanel')?.classList.remove('hidden');
  }

  function showAdminDashboard() {
    document.getElementById('adminPanel')?.classList.remove('hidden');
  }

  function showBookingManager() {
    document.getElementById('serviceManager').classList.add('hidden');
    document.getElementById('bookingManager').classList.remove('hidden');
    document.getElementById('businessSettings').classList.add('hidden');
    loadBookingsFromSupabase();
  }

  document.addEventListener('DOMContentLoaded', async () => {
    detectEnvironment();
    initializeEmailJS();

    await loadServicesFromSupabase();
    displayLogo();

    const today = new Date().toISOString().split('T')[0];
    const bookingDate = document.getElementById('bookingDate');
    if (bookingDate) bookingDate.min = today;

    const logoUpload = document.getElementById('logoUpload');
    if (logoUpload) {
      logoUpload.addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const preview = document.getElementById('logoPreview');
            preview.innerHTML = `<img src="${e.target.result}" alt="Logo Preview" style="max-width: 100%; max-height: 100px;">`;
          };
          reader.readAsDataURL(file);
        }
      });
    }
  });
</script>

    <script>
  document.addEventListener("DOMContentLoaded", function () {
    // Show admin login
    function showAdminLogin() {
      document.getElementById('userPanel').style.display = 'none';
      document.getElementById('adminPanelWrapper').style.display = 'block';
      document.getElementById('adminLoginSection').classList.remove('hidden');
      document.getElementById('adminPanel').classList.add('hidden');
    }
    window.showAdminLogin = showAdminLogin;

    // Show user panel
    function showUserPanel() {
      document.getElementById('userPanel').style.display = 'grid';
      document.getElementById('adminPanelWrapper').style.display = 'none';
    }
    window.showUserPanel = showUserPanel;

    // Show admin dashboard
    function showAdminDashboard() {
      document.getElementById('adminLoginSection').classList.add('hidden');
      document.getElementById('adminPanel').classList.remove('hidden');
      document.getElementById('serviceManager').classList.add('hidden');
      document.getElementById('bookingManager').classList.add('hidden');
      document.getElementById('businessSettings').classList.add('hidden');
    }
    window.showAdminDashboard = showAdminDashboard;

    // Show service manager
    function showServiceManager() {
      document.getElementById('serviceManager').classList.remove('hidden');
      document.getElementById('bookingManager').classList.add('hidden');
      document.getElementById('businessSettings').classList.add('hidden');
      populateAdminServiceList();
    }
    window.showServiceManager = showServiceManager;

    // Show booking manager
    function showBookingManager() {
      document.getElementById('serviceManager').classList.add('hidden');
      document.getElementById('bookingManager').classList.remove('hidden');
      document.getElementById('businessSettings').classList.add('hidden');
      populateBookingsList();
    }
    window.showBookingManager = showBookingManager;

    // Show business settings
    function showBusinessSettings() {
      document.getElementById('serviceManager').classList.add('hidden');
      document.getElementById('bookingManager').classList.add('hidden');
      document.getElementById('businessSettings').classList.remove('hidden');
      loadBusinessHoursToForm();
      loadEmailSettings();
    }
    window.showBusinessSettings = showBusinessSettings;

    // Logout admin
    function logoutAdmin() {
      document.getElementById('adminLoginSection').classList.remove('hidden');
      document.getElementById('adminPanel').classList.add('hidden');
      document.getElementById('adminLogin').reset();
      document.getElementById('adminLoginMessage').innerHTML = '';
    }
    window.logoutAdmin = logoutAdmin;
  });
        function showAdminDashboard() {
  document.getElementById('adminLoginSection').classList.add('hidden');
  document.getElementById('adminPanel').classList.remove('hidden');
  document.getElementById('serviceManager').classList.add('hidden');
  document.getElementById('bookingManager').classList.add('hidden');
  document.getElementById('businessSettings').classList.add('hidden');
}
window.showAdminDashboard = showAdminDashboard;

function showServiceManager() {
  document.getElementById('serviceManager').classList.remove('hidden');
  document.getElementById('bookingManager').classList.add('hidden');
  document.getElementById('businessSettings').classList.add('hidden');
  populateAdminServiceList();
}
window.showServiceManager = showServiceManager;

function showBookingManager() {
  document.getElementById('serviceManager').classList.add('hidden');
  document.getElementById('bookingManager').classList.remove('hidden');
  document.getElementById('businessSettings').classList.add('hidden');
  populateBookingsList();
}
window.showBookingManager = showBookingManager;

function showBusinessSettings() {
  document.getElementById('serviceManager').classList.add('hidden');
  document.getElementById('bookingManager').classList.add('hidden');
  document.getElementById('businessSettings').classList.remove('hidden');
  loadBusinessHoursToForm();
  loadEmailSettings();
}
window.showBusinessSettings = showBusinessSettings;

function openTab(event, tabId) {
  const tabPanels = document.getElementsByClassName('tab-panel');
  for (let i = 0; i < tabPanels.length; i++) {
    tabPanels[i].classList.remove('active');
  }

  const tabButtons = document.getElementsByClassName('tab-button');
  for (let i = 0; i < tabButtons.length; i++) {
    tabButtons[i].classList.remove('active');
  }

  document.getElementById(tabId).classList.add('active');
  event.currentTarget.classList.add('active');
}
window.openTab = openTab;

async function populateAdminServiceList() {
  console.log("populateAdminServiceList called (fetch from Supabase)");

  const { data, error } = await supabase.from('services').select('*').order('id', { ascending: true });

  const list = document.getElementById('adminServiceList');
  if (!list) return;

  list.innerHTML = '';

  if (error || !data || data.length === 0) {
    list.innerHTML = '<p>No services found or error loading services.</p>';
    return;
  }

 data.forEach(service => {
  const row = document.createElement('tr');
  row.innerHTML = `
    <td><input value="${service.name}" onchange="updateService(${service.id}, &quot;name&quot;, this.value)" /></td>
    <td><input value="${service.category}" onchange="updateService(${service.id}, &quot;category&quot;, this.value)" /></td>
    <td><input value="${service.price}" type="number" onchange="updateService(${service.id}, &quot;price&quot;, this.value)" /></td>
    <td><input value="${service.duration}" type="number" onchange="updateService(${service.id}, &quot;duration&quot;, this.value)" /></td>
    <td><button onclick="deleteService(${service.id})">Delete</button></td>
  `;
  list.appendChild(row);
});

}
window.populateAdminServiceList = populateAdminServiceList;
        async function updateService(id, field, value) {
  const { error } = await supabase.from('services').update({ [field]: value }).eq('id', id);
  if (error) {
    console.error("Failed to update service:", error);
    alert("Failed to update service.");
  }
}

async function deleteService(id) {
  if (!confirm("Are you sure you want to delete this service?")) return;
  const { error } = await supabase.from('services').delete().eq('id', id);
  if (error) {
    console.error("Failed to delete service:", error);
    alert("Failed to delete service.");
  } else {
    populateAdminServiceList();
  }
}
window.deleteService = deleteService;

async function addNewService() {
  const name = document.getElementById('newServiceName').value.trim();
  const category = document.getElementById('newServiceCategory').value.trim();
  const price = parseFloat(document.getElementById('newServicePrice').value);
  const duration = parseInt(document.getElementById('newServiceDuration').value);

  if (!name || !category || isNaN(price) || isNaN(duration)) {
    alert("Please fill in all fields correctly.");
    return;
  }

  const { error } = await supabase.from('services').insert([
    { name, category, price, duration }
  ]);

  if (error) {
    console.error("Failed to add service:", error);
    alert("Failed to add service.");
  } else {
    populateAdminServiceList();
    document.getElementById('newServiceName').value = '';
    document.getElementById('newServiceCategory').value = '';
    document.getElementById('newServicePrice').value = '';
    document.getElementById('newServiceDuration').value = '';
  }
}
window.addNewService = addNewService;


async function populateBookingsList() {
  console.log("populateBookingsList called (fetch from Supabase)");

  const { data, error } = await supabase.from('bookings').select('*').order('id', { ascending: false });

  const bookingsList = document.getElementById('bookingsList');
  bookingsList.innerHTML = '';

  if (error) {
    console.error("Error fetching bookings:", error);
    bookingsList.innerHTML = '<tr><td colspan="6">Failed to load bookings.</td></tr>';
    return;
  }

  if (!data || data.length === 0) {
    bookingsList.innerHTML = '<tr><td colspan="6">No bookings found.</td></tr>';
    return;
  }

  data.forEach(booking => {
    const services = JSON.parse(booking.services || '[]');
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${booking.date}<br>${booking.time_start} - ${booking.time_end}</td>
      <td>${booking.name}<br><small>${booking.phone}</small><br><small>${booking.email}</small></td>
      <td>${services.map(s => s.name).join(', ')}</td>
      <td>AED ${booking.total_price}<br>${booking.total_duration} mins</td>
      <td>${booking.status}</td>
      <td>
        <button class="btn" onclick="updateBookingStatus(${booking.id}, 'Confirmed')">Confirm</button>
        <button class="remove-btn" onclick="updateBookingStatus(${booking.id}, 'Cancelled')">Cancel</button>
      </td>
    `;
    bookingsList.appendChild(row);
  });
}
window.populateBookingsList = populateBookingsList;


function loadBusinessHoursToForm() {
  // Placeholder: Add logic to fetch and display business hours in the form
  console.log("loadBusinessHoursToForm executed (fetch from Supabase)");
}
window.loadBusinessHoursToForm = loadBusinessHoursToForm;

async function loadEmailSettings() {
  console.log("loadEmailSettings executed (fetch from Supabase)");

  const { data, error } = await supabase
    .from('email_settings')
    .select('*')
    .eq('id', 1)
    .single(); // Fetch the single row where id = 1

  if (error) {
    console.error('Failed to load email settings:', error.message);
    return;
  }

  // Apply values to the form fields
  document.getElementById('customerEmailToggle').checked = data.sendToCustomers;
  document.getElementById('adminEmailToggle').checked = data.sendToAdmin;
  document.getElementById('adminEmail').value = data.adminEmail || CONFIG.ADMIN_EMAIL;
}

        function adminAuth(event) {
  event.preventDefault();
  console.log("Login form submitted");

  const username = document.getElementById('adminUser').value.trim();
  const password = document.getElementById('adminPass').value.trim();

  const correctUsername = 'admin';
  const correctPassword = 'admin123';

  if (username === correctUsername && password === correctPassword) {
    document.getElementById('adminLoginSection').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    document.getElementById('adminPanelWrapper').style.display = 'block';
    document.getElementById('userPanel').style.display = 'none';
    showAdminDashboard();
    loadBusinessHoursToForm();
    loadEmailSettings();
  } else {
    document.getElementById('adminLoginMessage').innerHTML = `
      <div class="error-box">Invalid username or password.</div>
    `;
  }
}
        window.adminAuth = adminAuth;
window.showAdminDashboard = showAdminDashboard;
window.loadBusinessHoursToForm = loadBusinessHoursToForm;
window.populateAdminServiceList = populateAdminServiceList;
window.populateBookingsList = populateBookingsList;
window.showServiceManager = showServiceManager;
window.showBookingManager = showBookingManager;
window.showBusinessSettings = showBusinessSettings;
window.openTab = openTab;
window.logoutAdmin = logoutAdmin;


</script>
<script>
  window.showTimeSlots = async function () {
    const bookingDate = document.getElementById('bookingDate').value;
    if (!bookingDate) return alert("Please select a date first");

    const totalDuration = cart.reduce((sum, item) => sum + item.duration, 0);
    if (totalDuration === 0) return alert("Add at least one service to the cart");

    const { data: bookings } = await supabase
      .from('bookings')
      .select('time_start, time_end')
      .eq('date', bookingDate);

    const selectedDay = new Date(bookingDate).toLocaleDateString('en-US', { weekday: 'long' });

    const { data: hours, error } = await supabase
      .from('business_hours')
      .select('open_time, close_time, break_start, break_end')
      .eq('day', selectedDay)
      .single();

    if (error || !hours || !hours.open_time || !hours.close_time) {
      console.warn("Business hours not found or invalid for:", selectedDay, hours);
      alert("No valid business hours found for " + selectedDay);
      return;
    }

    let slots = generateTimeSlots(hours.open_time, hours.close_time, totalDuration);

    // Remove slots that fall during break
    if (hours.break_start && hours.break_end) {
      const breakStart = new Date(`1970-01-01T${hours.break_start}`);
      const breakEnd = new Date(`1970-01-01T${hours.break_end}`);
      slots = slots.filter(slot => {
        const slotStart = new Date(`1970-01-01T${slot.start}`);
        const slotEnd = new Date(`1970-01-01T${slot.end}`);
        return slotEnd <= breakStart || slotStart >= breakEnd;
      });
    }

    const available = filterAvailableSlots(slots, bookings || []);
    renderTimeSlotButtons(available);
  };

  function generateTimeSlots(openTime, closeTime, duration) {
    const slots = [];
    if (!openTime || !closeTime || !duration) return slots;

    const [startHour, startMin] = openTime.split(':').map(Number);
    const [endHour, endMin] = closeTime.split(':').map(Number);

    let current = new Date('1970-01-01T00:00:00');
    current.setHours(startHour, startMin, 0, 0);

    const end = new Date('1970-01-01T00:00:00');
    end.setHours(endHour, endMin, 0, 0);

    while (current.getTime() + duration * 60000 <= end.getTime()) {
      const slotStart = new Date(current);
      const slotEnd = new Date(current.getTime() + duration * 60000);
      slots.push({ start: formatTime(slotStart), end: formatTime(slotEnd) });
      current = slotEnd;
    }

    return slots;
  }

  function filterAvailableSlots(slots, bookings) {
    return slots.filter(slot => {
      const slotStart = new Date(`1970-01-01T${slot.start}`);
      const slotEnd = new Date(`1970-01-01T${slot.end}`);
      return !bookings.some(b => {
        const bookedStart = new Date(`1970-01-01T${b.time_start}`);
        const bookedEnd = new Date(`1970-01-01T${b.time_end}`);
        return slotStart < bookedEnd && slotEnd > bookedStart;
      });
    });
  }

function renderTimeSlotButtons(slots) {
  const container = document.getElementById('timeSlotButtons');
  const wrapper = document.getElementById('timeSlotContainer');
  container.innerHTML = '';
  wrapper.classList.remove('hidden');

  if (!slots || slots.length === 0) {
    container.innerHTML = "<p>No available slots for the selected date and duration.</p>";
    return;
  }

  slots.forEach(slot => {
    const btn = document.createElement('button');
    btn.textContent = `${slot.start} - ${slot.end}`;
    btn.className = 'time-slot-btn';
    btn.disabled = !slot.available;

    if (!slot.available) {
      btn.classList.add('disabled');
    }

    btn.onclick = () => {
      document.getElementById('selectedTime').value = JSON.stringify({ start: slot.start, end: slot.end });
      highlightSelectedSlot(btn);
    };

    container.appendChild(btn);
  });
}


  function highlightSelectedSlot(selectedBtn) {
    const allBtns = document.querySelectorAll('#timeSlotButtons button');
    allBtns.forEach(btn => btn.classList.remove('selected'));
    selectedBtn.classList.add('selected');
  }

  function formatTime(date) {
    return date.toTimeString().slice(0, 5);
  }
</script>

</body>
</html>
